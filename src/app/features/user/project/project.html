<!-- features/user/project/project.html -->
<div class="d-flex align-items-center gap-2 mb-3">
  <h4 class="mb-0">Mes projets</h4>
</div>

<div *ngIf="error() as e" class="alert alert-danger">{{ e }}</div>

<!-- Formulaire de création -->
<div class="card mb-4">
  <div class="card-body p-4">
    <form [formGroup]="form" (ngSubmit)="submit()" class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Nom du projet</label>
        <input class="form-control" formControlName="name" placeholder="Ex: Backoffice V2">
        <div class="invalid-feedback d-block" *ngIf="form.controls.name.invalid && form.controls.name.touched">
          Nom requis (min 2 caractères)
        </div>
      </div>

      <div class="col-md-4">
        <label class="form-label">Organization</label>
        <select class="form-select" formControlName="organizationID">
          <option value="{{org.id}}" *ngFor="let org of organizations">{{org.name}}</option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label">Statut</label>
        <select class="form-select" formControlName="status">
          <option value="PLANNED">PLANNED</option>
          <option value="IN_PROGRESS">IN_PROGRESS</option>
          <option value="DONE">DONE</option>
          <option value="ON_HOLD">ON_HOLD</option>
          <option value="CANCELLED">CANCELLED</option>
        </select>
      </div>

      <div class="col-12">
        <label class="form-label">Description</label>
        <textarea class="form-control" rows="3" formControlName="description"
          placeholder="Objectifs, scope, jalons…"></textarea>
      </div>

      <div class="col-12 d-flex gap-2">
        <button class="btn btn-primary" type="submit" [disabled]="loading()">Créer</button>
        <button class="btn btn-outline-secondary" type="button" (click)="fetch()"
          [disabled]="loading()">Rafraîchir</button>
        <div class="ms-auto text-muted" *ngIf="loading()">Chargement…</div>
      </div>
    </form>
  </div>
</div>

<!-- Liste des projets -->
<!-- projects.page.html -->
<div class="row">
  <div class="col-md-3 mb-3">
    <label class="form-label">Organization</label>
    <select class="form-select" [ngModel]="orgId()" (ngModelChange)="onOrgChange($event)">
      <option [ngValue]="0">Toutes</option>
      <option *ngFor="let org of organizations" [ngValue]="org.id">
        {{ org.name }}
      </option>
    </select>

  </div>
</div>
<div class="card p-3">
  <div class="card-body">
    <div *ngIf="loading()" class="alert alert-info">Chargement…</div>
    <div *ngIf="error()" class="alert alert-danger">{{ error() }}</div>

    <div class="table-responsive" *ngIf="!loading() && !error()">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Status</th>
            <th>Organization</th>
            <th>Created at</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of projects; index as i">
            <td>{{ i + 1 }}</td>
            <td class="fw-semibold">{{ p.project.name }}</td>
            <td>{{ p.project.status }}</td>
            <td>{{ p.organization.name }}</td>
            <td>{{ p.project.createdAt | date:'medium' }}</td>
          </tr>

          <tr *ngIf="!projects.length">
            <td colspan="5" class="text-muted">Aucun projet pour cette organisation.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>